<!DOCTYPE html>
<html lang="en">
<head>
  <script type="text/javascript">
  //<![CDATA[
  function xmlhttpPost() {
    var searchform = document.getElementById('searchform');
    search(searchform.url.value);
  }

  function search(query) {
    var xmlHttpReq = false;
    var self = this;
    if (window.XMLHttpRequest) { // Mozilla/Safari
      self.xmlHttpReq = new XMLHttpRequest();
    }
    else if (window.ActiveXObject) { // IE
      self.xmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
    }
    self.xmlHttpReq.open('GET', "/solr/select?q=sku:\"" + query + "\" OR host_s:\"" + query + "\" OR host_dnc_s:\"" + query + "\" OR host_organization_s:\"" + query + "\" OR host_organizationdnc_s:\"" + query + "\" OR host_subdomain_s:\"" + query + "\"&start=0&rows=100&wt=yjson", true);
    self.xmlHttpReq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    self.xmlHttpReq.onreadystatechange = function() {
      if (self.xmlHttpReq.readyState == 4) {
        updatepage(self.xmlHttpReq.responseText);
      }
    }
    self.xmlHttpReq.send(null);
  }

  function updatepage(str) {
    var raw = document.getElementById("raw");
    if (raw != null) raw.innerHTML = str;
    var rsp = eval("("+str+")");
    var firstChannel = rsp.channels[0];
    var totalResults = firstChannel.totalResults.replace(/[,.]/,"");
    var startIndex = firstChannel.startIndex;
    var itemsPerPage = firstChannel.itemsPerPage;
    var navigation = firstChannel.navigation;

    var html = "";

    if (totalResults > 0 && firstChannel.items.length > 0) {
      var item;
      html += "<table class=\"networkTable\" border=\"0\" cellpadding=\"2\" cellspacing=\"1\" width=\"99%\">";
      html += "<tr class=\"TableHeader\" valign=\"bottom\">";
      html += "<td>URL from index (total results = " + totalResults + ")<\/td>";
      for (var i = 0; i < firstChannel.items.length; i++) {
        item = firstChannel.items[i];
        html += "<tr class=\"TableCellLight\"><td align=\"left\"><a href=\"ViewFile.html?url=" + item.link + "\">" + item.link + "<\/a><\/td>";
      }
      html += "<\/table>";
    }
    document.getElementById("searchresults").innerHTML = html;
  }
//]]>
</script>
<title>YaCy '#[clientname]#': View URL Content</title>
#%env/templates/header-backend.template%#
<script type="text/javascript" src="/js/yaml/tablesorter/jquery.tablesorter.min.js"></script>
<script type="text/javascript" src="/js/highslide/highslide.js"></script>
</head>

<body id="viewFile">
  #(topmenu)#
  #%env/templates/page-start.template%#
  ::
  #%env/templates/page-start.template%#
  #(/topmenu)#

  <div id="api">
    <a href="http://localhost:8090/api/getpageinfo_p.xml?actions=title,robots&url=#[url]#" id="apilink" title="See the page info about the url.">
      <img src="/env/grafics/api.png" width="60" height="40" alt="API"/>
    </a>
  </div>

  <div id="devInfo">
    - use a template for InfoCacheEntry
    - scripts need updates
    - couldn't check all details, may contain display errors
  </div>


  <h1>View URL Content</h1>

  <form method="get" action="ViewFile.html" id="searchform" accept-charset="ascii" onkeyup="xmlhttpPost(); return false;">
    <fieldset>
      <legend>URL Info Viewer</legend>
      <fieldset class="formSection">
        <legend>URL</legend>
        <div class="content">
          <input type="text" size="60" name="url" id="url" value="#[url]#" />
        </div>
      </fieldset>
      <fieldset class="formControl">
        <div class="content">
          <button onClick="location.href='/HostBrowser.html?path=' + document.getElementById('url').value; return false;" class="icon-showMore">Browse Host</button>
          <button type="submit" name="show" class="icon-showMore primary">Show Metadata</button>
        </div>
      </fieldset>
    </fieldset>
  </form>

  #(error)#
  <form method="get" action="ViewFile.html" accept-charset="ascii">
    <fieldset>
      <legend>URL Metadata</legend>
      <fieldset class="formSection">
        <legend>URL</legend>
        <div class="content">
          <a href="#[url]#">#[url]#</a>
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>Hash</legend>
        <div class="content">
          <a href="/solr/select?defType=edismax&start=0&rows=3&core=collection1&wt=html&q=id:%22#[hash]#%22">#[hash]#</a> (click this for full metadata)
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>In Metadata</legend>
        <div class="content">
          #(inurldb)#no::yes#(/inurldb)#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>In Cache</legend>
        <div class="content">
          #(incache)#no::yes#(/incache)#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>Word Count</legend>
        <div class="content">
          #[wordCount]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>Description</legend>
        <div class="content">
          #[desc]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>Size</legend>
        <div class="content">
          #[size]# Bytes
        </div>
      </fieldset>
      #(mimeTypeAvailable)#::
      <fieldset class="formSection">
        <legend>MimeType</legend>
        <div class="content">
          #[mimeType]#
        </div>
      </fieldset>
      #(/mimeTypeAvailable)#
      <fieldset class="formSection">
        <legend>Collections</legend>
        <div class="content">
          #[collections]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>Triplestore</legend>
        <div class="content">
          <code><pre>#[triples]#</pre></code>
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>View as</legend>
        <div class="content">
          <select id="viewMode" name="viewMode" onchange='this.form.submit()'>
            <option value="iframeWeb"#(vMode-iframeWeb)#:: selected="selected"#(/vMode-iframeWeb)#>Original from Web</option>
            <option value="iframeCache"#(vMode-iframeCache)#:: selected="selected"#(/vMode-iframeCache)#>Original from Cache</option>
            <option value="plain"#(vMode-plain)#:: selected="selected"#(/vMode-plain)#>Plain Text</option>
            <option value="parsed"#(vMode-parsed)#:: selected="selected"#(/vMode-parsed)#>Parsed Text</option>
            <option value="sentences"#(vMode-sentences)#:: selected="selected"#(/vMode-sentences)#>Parsed Sentences</option>
            <option value="words"#(vMode-words)#:: selected="selected"#(/vMode-words)#>Parsed Tokens/Words</option>
            <option value="links"#(vMode-links)#:: selected="selected"#(/vMode-links)#>Link List</option>
            <option value="iframeCitations"#(vMode-iframeCitations)#:: selected="selected"#(/vMode-iframeCitations)#>Citation Report</option>
          </select>
        </div>
      </fieldset>
      <input type="hidden" name="words" value="#[words]#" />
      <input type="hidden" name="urlHash" value="#[hash]#" />
      <input type="hidden" name="url" value="#[url]#" />
    </fieldset>
  </form>
  :: <!-- 1 -->
  :: <!-- 2 -->
  <p class="ycu-message ycu-message-error">Unable to find URL Entry in DB</p>
  :: <!-- 3 -->
  <p class="ycu-message ycu-message-error">Invalid URL</p>
  :: <!-- 4 -->
  <p class="ycu-message ycu-message-error">Unable to download resource content.
    <br/>
    <span class="tt">#[errorText]#</span>
  </p>
  :: <!-- 5 -->
  <p class="ycu-message ycu-message-error">Unable to parse resource content.
    <br/>
    <span class="tt">#[errorText]#</span>
  </p>
  :: <!-- 6 -->
  <p class="ycu-message ycu-message-error">Unsupported protocol.</p>
  #(/error)#
  #(viewMode)#::
  <fieldset class="main">
    <legend>Details</legend>
    #(/viewMode)#
    #(viewMode)#
    :: <!-- 1 -->
    <fieldset class="formSection">
      <legend>Original Content from Web</legend>
      <div class="content noIndent">
        <p class="tt">
          #[plainText]#
        </p>
      </div>
    </fieldset>
    :: <!-- 2 -->
    <fieldset class="formGroup">
      <legend>Dublin Core</legend>
      <fieldset class="formSection">
        <legend>dc:title</legend>
        <div class="content">
          #[title]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>dc:creator</legend>
        <div class="content">
          #[creator]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>dc:subject</legend>
        <div class="content">
          #[subject]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>dc:description</legend>
        <div class="content">
          #[description]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>dc:publisher</legend>
        <div class="content">
          #[publisher]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>dc:format</legend>
        <div class="content">
          #[format]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>dc:identifier</legend>
        <div class="content">
          #[identifier]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>dc:source</legend>
        <div class="content">
          #[source]#
        </div>
      </fieldset>
    </fieldset>

    <fieldset class="formGroup">
      <legend>geoLocation</legend>
      <div class="description">
        <p>
          <a href="osm.png?lon=#[lon]#&lat=#[lat]#&zoom=14" onclick="return hs.expand(this)">View location on map.</a>
        </p>
      </div>
      <fieldset class="formSection">
        <legend>geo:lat</legend>
        <div class⁼"content">
          #[lat]#
        </div>
      </fieldset>
      <fieldset class="formSection">
        <legend>geo:long</legend>
        <div class⁼"content">
          #[lon]#
        </div>
      </fieldset>
    </fieldset>

    <fieldset class="formGroup">
      <legend>Parsed Content</legend>
      <fieldset class="formSection">
        <legend>Text</legend>
        <div class="content">
          <code class="plain">
            #[parsedText]#
          </code>
        </div>
      </fieldset>
    </fieldset>
    :: <!-- 3 -->
    <fieldset class="formGroup">
      <legend>Parsed Content</legend>
      <fieldset class="formSection">
        <legend>Sentences</legend>
        <div class="content">
          <ol>
            #{sentences}#
            <li class="tt">#[text]#</li>
            #{/sentences}#
          </ol>
        </div>
      </fieldset>
    </fieldset>
    :: <!-- 4 -->
    <fieldset class="formGroup">
      <legend>Original</legend>
      <fieldset class="formSection">
        <legend>From Web</legend>
        <iframe src="#[url]#" class="autoSize border"/>
      </fieldset>
    </fieldset>
    :: <!-- 5 -->
    <fieldset class="formGroup">
      <legend>Original</legend>
      <fieldset class="formSection">
        <legend>From Cache</legend>
        #(html)#::<iframe src="/CacheResource_p.html?url=#[url]#" width="800" height="400" />#(/html)#
        #(png)#::<iframe src="/CacheResource_p.png?url=#[url]#" width="800" height="400" />#(/png)#
      </fieldset>
    </fieldset>
    :: <!-- 6 -->
    <fieldset class="formGroup">
      <legend>Link List</legend>
      <div class="content noIndent">
        <table>
          <thead>
            <tr>
              <th class="noSort">nr</th>
              <th>type</th>
              <th>name</th>
              <th class="noSort">link</th>
              <th>text</th>
              <th>rel</th>
            </tr>
          </thead>
          <tbody>
            #{links}#
            <tr>
              <td>#[nr]#</td>
              <td>#[type]#</td>
              <td>#[name]#</td>
              <td class="breakAll"><a href="#[url]#">#[link]#</a></td>
              <td>#[text]#</td>
              <td>#[rel]#</td>
            </tr>
            #{/links}#
          </tbody>
        </table>
      </div>
    </fieldset>
    :: <!-- 7 -->
    <fieldset class="formGroup">
      <legend>Parsed Tokens</legend>
      <div class="content noIndent">
        <ol>
          #{words}#
          <li class="tt">#[word]#</li>
          #{/words}#
        </ol>
      </div>
    </fieldset>
    :: <!-- 8 -->
    <fieldset class="formGroup">
      <legend>CitationReport</legend>
      <div class="content noIndent">
        <iframe src="/api/citation.html?url=#[url]#" class="border autoSize" />
      </div>
    </fieldset>
    #(/viewMode)#
    #(viewMode)#::
  </fieldset>
  #(/viewMode)#

  #%env/templates/page-end.template%#
</body>
</html>