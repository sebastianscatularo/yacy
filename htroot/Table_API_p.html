<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>YaCy '#[clientname]#': Peer Steering</title>
  #%env/templates/header-backend.template%#
  <script type="text/javascript" src="/js/yaml/tablesorter/jquery.tablesorter.min.js"></script>
  #(showtable)#::
  <link rel="alternate" type="application/xml" title="Tables" href="Tables.rss?table=#[table]#" />
  #(/showtable)#
  <script type="text/javascript">
  <!--
    function submitchange(from) {
    	document.getElementById("apilist").action = "Table_API_p.html#" + from;
      document.getElementById ("scheduleeventaction").value = "true";
      document.getElementById("current_pk").value = from;
      document.getElementById("apilist").submit();
    }
    -->
    </script>
  </head>

  <body id="TableApi">
    #(inline)#
    #%env/templates/page-start.template%#
    ::
    #%env/templates/page-start-inline.template%#
    #(/inline)#

          <div id="api">
            <img src="/env/grafics/api.png" width="60" height="40" alt="API" title="Click on this API button to see a documentation of the XML data that can be retrieved."/>
            <div class="hidden">
              The information that is presented on this page can also be retrieved <a href="/api/table_p.xml?table=api&count=100&search=">as XML</a>.
              To see a list of all APIs, please visit the <a href="http://www.yacy-websuche.de/wiki/index.php/Dev:API">API wiki page</a>.
            </div>
          </div>

<div id="devInfo">
Todo:
 - scripts need update
 - toggle buttons based on selection state
</div>

          <div id="fullcontent">
            #(inline)#
            <h1>Process Scheduler</h1>
            <p>
              This table shows actions that had been issued on the YaCy interface to change the configuration or to request crawl actions.
              These recorded actions can be used to repeat specific actions and to send them to a scheduler for a periodic execution.
            </p>
            ::#(/inline)#
            #(showschedulerhint)#::
            <p>
              Scheduled actions are executed after the next execution date has arrived within a time frame of #[tfminutes]# minutes.
            </p>
            #(/showschedulerhint)#

            #(showtable)#::
            <form action="Table_API_p.html" method="post" enctype="multipart/form-data" accept-charset="UTF-8" id="apilist">
              <fieldset>
                <legend>Recorded Actions</legend>

                <fieldset class="formGroup">
                  <legend>List of Recorded Actions</legend>
                  <div class="content noIndent">
                    <span id="resCounter" class="resourceQueryBox">
                      #(navigation)#::
                      #(left)#
                      <img src="env/grafics/navdl.gif" alt="no previous page" />
                      ::
                      <a href="Table_API_p.html?startRecord=#[startRecord]#&amp;maximumRecords=#[maximumRecords]#&amp;inline=#(inline)#false::true#(/inline)#&amp;filter=#[filter]#" target="_self">
                        <img src="env/grafics/navsl.gif" alt="previous page" />
                      </a>
                      #(/left)#

                      #[startRecord]#-#[to]# of #[of]#

                      #(right)#
                      <img src="env/grafics/navdr.gif" alt="no next page" />
                      ::
                      <a href="Table_API_p.html?startRecord=#[startRecord]#&amp;maximumRecords=#[maximumRecords]#&amp;inline=#(inline)#false::true#(/inline)#&amp;filter=#[filter]#" target="_self">
                        <img src="env/grafics/navsr.gif" alt="next page" />
                      </a>
                      #(/right)#
                      <img src="env/grafics/nave.gif" alt="" />
                      #(/navigation)#

                      <input type="hidden" name="startRecord" value="#[startRecord]#" />
                      <input type="hidden" name="maximumRecords" value="#[maximumRecords]#" />
                      <input type="hidden" name="inline" value="#(inline)#false::true#(/inline)#" />
                      <input type="hidden" name="filter" value="#[filter]#" />
                      <span class="queryBox">
                        <input type="text" name="query" value="#[query]#"/>
                      </span>
                    </span>

                    <div style="clear:both;">
                      <table class="sortable">
                        <thead>
                          <tr valign="bottom">
                            <th><input type="checkbox" data-action="checkAllToggle"/></th>
                            <th>Type</th>
                            <th style="width: 100%;">Comment</th>
                            <th>Call<br/>Count</th>
                            <th>Recording<br/>Date</th>
                            <th>Last&nbsp;Exec<br/>Date</th>
                            <th>Next&nbsp;Exec<br/>Date</th>
                            <th class="sorttable_nosort">Event Trigger</th>
                            <th class="sorttable_nosort">Scheduler</th>
                            #(inline)#<th class="sorttable_nosort">URL</th>::#(/inline)#
                          </tr>
                        </thead>
                        <tbody>
                          #{list}#
                          <tr id="#[pk]#">
                            <td valign="top" align="left">
                              <input type="checkbox" name="item_#[count]#" value="mark_#[pk]#" />
                            </td>
                            <td valign="top">
                              #[type]#
                              #(isCrawlerStart)#::
                              <br/><br/>
                              <a href="#[url]#" title="clone">
                                <img src="/env/grafics/doc.gif">
                                <img src="/env/grafics/right.gif">
                                <img src="/env/grafics/doc.gif">
                              </a>
                              #(/isCrawlerStart)#
                            </td>
                            <td valign="top">#[comment]#</td>
                            <td valign="top">#[callcount]#</td>
                            <td valign="top">#[dateRecording]#</td>
                            <td valign="top">#[dateLastExec]#</td>
                            <td valign="top">#[dateNextExec]#</td>
                            <td valign="top">
                              #(event)#
                              <select name="event_select_#[pk]#" onchange='submitchange("#[pk]#")'>
                                <option value="off" selected="selected">no event</option>
                                <option value="on">activate event</option>
                              </select>
                              ::
                              <table>
                                <tr><td>
                                  <select name="event_kind_#[pk]#" onchange='submitchange("#[pk]#")'>
                                    <option value="off" #(selectedoff)#::selected="selected"#(/selectedoff)#>off</option>
                                    <option value="once" #(selectedonce)#::selected="selected"#(/selectedonce)#>run once</option>
                                    <option value="regular" #(selectedregular)#::selected="selected"#(/selectedregular)#>run regular</option>
                                  </select>
                                </td>
                                <td>
                                  <select name="event_action_#[pk]#" onchange='submitchange("#[pk]#")'>
                                    <option value="startup" #(selectedstartup)#::selected="selected"#(/selectedstartup)#>after start-up</option>
                                    <option value="0000" #(selected0000)#::selected="selected"#(/selected0000)#>at 00:00h</option>
                                    <option value="0100" #(selected0100)#::selected="selected"#(/selected0100)#>at 01:00h</option>
                                    <option value="0200" #(selected0200)#::selected="selected"#(/selected0200)#>at 02:00h</option>
                                    <option value="0300" #(selected0300)#::selected="selected"#(/selected0300)#>at 03:00h</option>
                                    <option value="0400" #(selected0400)#::selected="selected"#(/selected0400)#>at 04:00h</option>
                                    <option value="0500" #(selected0500)#::selected="selected"#(/selected0500)#>at 05:00h</option>
                                    <option value="0600" #(selected0600)#::selected="selected"#(/selected0600)#>at 06:00h</option>
                                    <option value="0700" #(selected0700)#::selected="selected"#(/selected0700)#>at 07:00h</option>
                                    <option value="0800" #(selected0800)#::selected="selected"#(/selected0800)#>at 08:00h</option>
                                    <option value="0900" #(selected0900)#::selected="selected"#(/selected0900)#>at 09:00h</option>
                                    <option value="1000" #(selected1000)#::selected="selected"#(/selected1000)#>at 10:00h</option>
                                    <option value="1100" #(selected1100)#::selected="selected"#(/selected1100)#>at 11:00h</option>
                                    <option value="1200" #(selected1200)#::selected="selected"#(/selected1200)#>at 12:00h</option>
                                    <option value="1300" #(selected1300)#::selected="selected"#(/selected1300)#>at 13:00h</option>
                                    <option value="1400" #(selected1400)#::selected="selected"#(/selected1400)#>at 14:00h</option>
                                    <option value="1500" #(selected1500)#::selected="selected"#(/selected1500)#>at 15:00h</option>
                                    <option value="1600" #(selected1600)#::selected="selected"#(/selected1600)#>at 16:00h</option>
                                    <option value="1700" #(selected1700)#::selected="selected"#(/selected1700)#>at 17:00h</option>
                                    <option value="1800" #(selected1800)#::selected="selected"#(/selected1800)#>at 18:00h</option>
                                    <option value="1900" #(selected1900)#::selected="selected"#(/selected1900)#>at 19:00h</option>
                                    <option value="2000" #(selected2000)#::selected="selected"#(/selected2000)#>at 20:00h</option>
                                    <option value="2100" #(selected2100)#::selected="selected"#(/selected2100)#>at 21:00h</option>
                                    <option value="2200" #(selected2200)#::selected="selected"#(/selected2200)#>at 22:00h</option>
                                    <option value="2300" #(selected2300)#::selected="selected"#(/selected2300)#>at 23:00h</option>
                                  </select>
                                </td>
                              </tr>
                            </table>
                            #(/event)#
                          </td>
                          <td valign="top">
                            #(scheduler)#
                            <select name="repeat_select_#[pk]#" onchange='submitchange("#[pk]#")'#(disabled)#:: disabled="disabled"#(/disabled)#>
                              <option value="off" selected="selected">no repetition</option>
                              <option value="on">activate scheduler</option>
                            </select>
                            ::
                            <span class="nobr">
                              <select name="repeat_time_#[pk]#" onchange='submitchange("#[pk]#")'>
                                #{scale}#
                                <option value="#[time]#" #(selected)#::selected="selected"#(/selected)#>#[time]#</option>
                                #{/scale}#
                              </select>
                              <select name="repeat_unit_#[pk]#" onchange='submitchange("#[pk]#")'>
                                <option value="selminutes" #(selectedMinutes)#::selected="selected"#(/selectedMinutes)#>minutes</option>
                                <option value="selhours" #(selectedHours)#::selected="selected"#(/selectedHours)#>hours</option>
                                <option value="seldays" #(selectedDays)#::selected="selected"#(/selectedDays)#>days</option>
                              </select>
                            </span>
                            #(/scheduler)#
                          </td>
                          #(inline)#<td valign="top">#[url]#</td>::#(/inline)#
                        </tr>
                        #{/list}#
                      </tbody>
                    </table>
                  </div>
                </div>
              </fieldset>

              <fieldset class="formGroup">
                <legend>Cleanup</legend>
                <fieldset class="formSection">
                  <legend>Delete old entries</legend>
                  <div class="content">
                    <label for="deleteOldByTime">Delete all Actions which had been created before</label>
                    <select name="deleteoldtime" id="deleteOldByTime">
                      <option value="1">1 day</option>
                      <option value="2">2 days</option>
                      <option value="3">3 days</option>
                      <option value="4">4 days</option>
                      <option value="5">5 days</option>
                      <option value="6">6 days</option>
                      <option value="7">1 week</option>
                      <option value="14">2 weeks</option>
                      <option value="21">3 weeks</option>
                      <option value="30">1 month</option>
                      <option value="60" selected="selected">2 months</option>
                      <option value="90">3 months</option>
                      <option value="180">6 months</option>
                      <option value="270">9 months</option>
                      <option value="365">1 year</option>
                      <option value="730">2 years</option>
                    </select>
                  </div>
                </fieldset>
              </fieldset>

              <input type="hidden" name="scheduleeventaction" id="scheduleeventaction" value="false" />
              <input type="hidden" name="current_pk" id="current_pk" value="" />
              <input type="hidden" name="num" value="#[num]#" />

              <fieldset class="formControl" data-id="formControl">
                <div class="content">
                  <button type="submit" name="deleteold" class="icon-delete">Run cleanup</button>
                  <button type="submit" name="deleterows" class="icon-delete">Delete Selected Actions</button>
                  <button type="submit" name="execrows" class="primary icon-run">Execute Selected Actions</button>
                </div>
              </fieldset>


            </fieldset>
          </form>
          #(/showtable)#

          #(showexec)#::
          <form action="#">
            <fieldset>
              <legend>Result of API execution</legend>
              <table class="sortable">
                <thead>
                  <tr valign="bottom">
                    <th>Status</th>
                    <th>URL</th>
                  </tr>
                </thead>
                <tbody>
                  #{list}#
                  <tr>
                    <td>#[status]#</td>
                    <td>#[url]#</td>
                  </tr>
                  #{/list}#
                </tbody>
              </table>
            </fieldset>
          </form>
          #(/showexec)#

          #(inline)##%env/templates/footer.template%#::#(/inline)#
        </div>

        <script type="text/javascript">
        <!--
        parentPage = parent.document.getElementById('APITable');
        if (parentPage != null) parentPage.height = document.getElementById('fullcontent').offsetHeight + 30;
        -->
        </script>
  #(inline)#
  #%env/templates/page-end.template%#
  ::
  #%env/templates/page-end-inline.template%#
  #(/inline)#
</body>
</html>
