<!DOCTYPE html>
<html lang="en">
<head>
  #(forwardToSteering)#::<meta http-equiv="REFRESH" content="0; url=/Steering.html?update=1&amp;releaseinstall=#[release]#" />#(/forwardToSteering)#
  <title>YaCy '#[clientname]#': System Update</title>
  #%env/templates/header-backend.template%#
</head>

<body id="configUpdate">
  #%env/templates/page-start.template%#

  <div id="devInfo">
    status: valid html5
  </div>

  <h1>System Update</h1>

  #(deploys)#::
  <p class="ycu-message ycu-message-info">
    Release will be installed. Please wait.
  </p>
  #(/deploys)#

  #(candeploy)#
  <p class="ycu-message ycu-message-info">
    This servlet can only be used on operation systems that are currently supported for deploy functions.
    If you see this message this means that your operation system is not supported.
  </p>
  ::
  <h2 id="manualUpdate">Manual System Update</h2>
  <fieldset class="main" id="manualUpdateForm">
    <legend>Configuration</legend>
    <fieldset class="formSection">
      <legend>Current installed Release</legend>
      <div class="content">
        #[versionpp]#
      </div>
    </fieldset>
    <fieldset class="formSection">
      <legend>Available Releases</legend>
      <div class="content">
        <form action="ConfigUpdate_p.html#manualUpdateForm" method="get" accept-charset="UTF-8"><p>
          <select name="releasedownload">
            #{availreleases}#
            <option #(selected)#::selected="selected"#(/selected)# value="#[url]#">#[name]# #(signatures)#(unsigned)::(signed)#(/signatures)#</option>
            #{/availreleases}#
          </select>
          <em>(<a href="https://gitorious.org/yacy/rc1/commits/master" target="_blank">changelog</a> and <a href="https://gitorious.org/yacy/rc1/commits/master/feed.atom">RSS feed</a>)</em>
          <p>
            <button type="submit" name="downloadRelease" class="plain icon-run">Download Release</button>
            <button type="submit" name="checkRelease" class="plain icon-run">Check for new Release</button>
          </p>
        </form>
      </div>
    </fieldset>
    <fieldset class="formSection">
      <legend>Downloaded Releases</legend>
      <div class="content">
        <form action="ConfigUpdate_p.html#manualUpdateForm" method="get" accept-charset="UTF-8">
          <p>
            #(downloadsAvailable)#
            No downloaded releases available for deployment.
            ::
            <select name="releaseinstall">
              #(/downloadsAvailable)#
              #{downloadedreleases}#
              <option #(selected)#::selected="selected"#(/selected)# value="#[file]#">#[name]# #(signature)#(no signature)::(signed)#(/signature)#</option>
              #{/downloadedreleases}#
              #(downloadsAvailable)#::
            </select>
            #(/downloadsAvailable)#

            #(deployenabled)#::
            no automated installation on development environments
            ::
            <button type="submit" name="deleteRelease" class="plain icon-delete" #(buttonsActive)#disabled="disabled"::#(/buttonsActive)#>Delete Release</button>
            <button type="submit" name="update" class="plain icon-run" #(buttonsActive)#disabled="disabled"::#(/buttonsActive)#>Install Release</button>
            #(/deployenabled)#
          </p>
        </form>
      </div>
    </fieldset>
    <fieldset class="formSection">
      <legend>Automatic Update</legend>
      <div class="content">
        <form action="ConfigUpdate_p.html#manualUpdateForm" method="get" accept-charset="UTF-8"><p>
          This will check for new releases, download if available and restart with downloaded release.
          <p>
            <button type="submit" name="autoUpdate" class="plain icon-run">Check + Download + Install Release Now</button>
            #(autoUpdate)#::
            <p class="ycu-message ycu-message-info">Download of release #[downloadedRelease]# finished. Restart Initiated.</p>::
            <p class="ycu-message ycu-message-error">No more recent release found.</p>::
            <p class="ycu-message ycu-message-error">Omitting update because this is a development environment.</p>::
            <p class="ycu-message ycu-message-error">Omitting update because download of release #[downloadedRelease]# failed.</p>
            #(/autoUpdate)#
          </p></form>
        </div>
      </fieldset>
    </fieldset>

    <h2>Automated System Update</h2>
    <form action="ConfigUpdate_p.html#autoUpdateForm" id="autoUpdateForm" method="get" accept-charset="UTF-8">
      <fieldset>
        <legend>Configuration</legend>
        <fieldset class="formSection">
          <legend>Update method</legend>
          <div class="content">
            <p>
              <input type="radio" name="updateMode" id="updateModeManual" value="manual" #(manualUpdateChecked)#::checked="checked" #(/manualUpdateChecked)#/>
              <label for="updateModeManual">Manual update</label>
              <br/>
              No automatic look-up, updates can be made manually using the <a href="#manualUpdate">Manual System Update</a> Interface.
            </p>
            <p>
              <input type="radio" name="updateMode" id="updateModeAuto" value="auto" #(autoUpdateChecked)#::checked="checked" #(/autoUpdateChecked)#/>
              <label for="updateModeAuto">Automatic update</label>
              <br/>
              Updates are made within fixed cycles, using the configuration below.
            </p>
          </div>
        </fieldset>
        <fieldset class="formGroup" data-toggle-id="updateModeAuto">
          <legend>Automatic update settings</legend>
          <fieldset class="formSection">
            <legend>Time between lookup</legend>
            <div class="content">
              <label for="updateCycleTime">Check for updates every</label>
              <input type="text" name="cycle" id="updateCycleTime" value="#[cycle]#" size="4" class="spinner" maxlength="4"/> hours.
            </div>
          </fieldset>
          <fieldset class="formSection">
            <legend>Release blacklist</legend>
            <div class="content">
              <label for="updateBlacklistRegEx">Ignore update versions matching <em>(regex on release number strings)</em></label>
              <input type="text" name="blacklist" id="updateBlacklistRegEx" value="#[blacklist]#" maxlength="20" />
            </div>
          </fieldset>
          <fieldset class="formSection">
            <legend>Release type</legend>
            <div class="content">
              <p>
                <input type="radio" name="releaseType" value="main" #(releaseTypeMainChecked)#::checked="checked" #(/releaseTypeMainChecked)#/>Get only main releases.
              </p>
              <p>
                <input type="radio" name="releaseType" value="any" #(releaseTypeAnyChecked)#::checked="checked" #(/releaseTypeAnyChecked)#/>Get any release including developer releases.
              </p>
            </div>
          </fieldset>
          <fieldset class="formSection">
            <legend>Security</legend>
            <div class="content">
              <input type="checkbox" name="onlySignedFiles" value="true" #(onlySignedFiles)#::checked="checked" #(/onlySignedFiles)#/>
              only accept signed files
            </div>
          </fieldset>
        </fieldset>

        <fieldset class="formControl">
          <div class="content">
            <button type="submit" name="configSubmit" class="primary icon-run">Save configuration</button>
          </div>
        </fieldset>

        #(configCommit)#::
        <p class="ycu-message ycu-message-info">
          Your changes have been saved.
        </p>
        #(/configCommit)#
      </fieldset>
    </form>

    <h2>System Update Statistics</h2>
    <fieldset class="framed main">
      <legend>System Update Statistics</legend>
      <fieldset class="formSection">
        <legend>Last Lookup</legend>
        <div class="content">#(lastlookup)#never::#[time]##(/lastlookup)#</div>
      </fieldset>
      <fieldset class="formSection">
        <legend>Last Download</legend>
        <div class="content">#(lastdownload)#never::#[time]##(/lastdownload)#</div>
      </fieldset>
      <fieldset class="formSection">
        <legend>Last Deploy</legend>
        <div class="content">#(lastdeploy)#never::#[time]##(/lastdeploy)#</div>
      </fieldset>
    </fieldset>
    ::
    <p>You installed YaCy with a package manager. To update YaCy, use the package manager:</p>
    <p>manual update:<br/>apt-get update &amp;&amp; apt-get install yacy</p>
    <p>automatic update: add the following line to /etc/crontab<br/>0 6 * * * root apt-get update &amp;&amp; apt-get -y --force-yes install yacy</p>
    ::
    <p>YaCy has been installed to the Program Files directory. Automatic update is not possible.<br/>Download and install the latest version from the web page <a href="http://www.yacy.net/" target="_blank">http://www.yacy.net/</a></p>
    ::
    #(/candeploy)#

    #%env/templates/page-end.template%#
  </body>
  </html>
