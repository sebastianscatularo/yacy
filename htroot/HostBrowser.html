<!DOCTYPE html>
<html lang="en">
<head>
  <title>YaCy '#[clientname]#': Host Browser</title>
  #%env/templates/header-backend.template%#
  <script type="text/javascript" src="/js/yaml/tablesorter/jquery.tablesorter.min.js"></script>
  <script type="text/javascript">
  //<![CDATA[
  function xmlhttpPost() {
    var searchform = document.getElementById('searchform');
    search(searchform.path.value);
  }

  function search(query) {
    var xmlHttpReq = false;
    var self = this;
    if (window.XMLHttpRequest) { // Mozilla/Safari
      self.xmlHttpReq = new XMLHttpRequest();
    }
    else if (window.ActiveXObject) { // IE
      self.xmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
    }
    self.xmlHttpReq.open('GET', "/solr/select?q=sku:\"" + query + "\" OR host_s:\"" + query + "\" OR host_dnc_s:\"" + query + "\" OR host_organization_s:\"" + query + "\" OR host_organizationdnc_s:\"" + query + "\" OR host_subdomain_s:\"" + query + "\" OR url_paths_sxt:\"" + query + "\" OR url_file_name_s:\"" + query + "\"&start=0&rows=100&wt=yjson", true);
    self.xmlHttpReq.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    self.xmlHttpReq.onreadystatechange = function() {
      if (self.xmlHttpReq.readyState == 4) {
        updatepage(self.xmlHttpReq.responseText);
      }
    }
    self.xmlHttpReq.send(null);
  }

  function updatepage(str) {
    var rsp = eval("("+str+")");
    var firstChannel = rsp.channels[0];
    var totalResults = firstChannel.totalResults.replace(/[,.]/,"");
    var startIndex = firstChannel.startIndex;
    var itemsPerPage = firstChannel.itemsPerPage;
    var navigation = firstChannel.navigation;

    var html = "";

    if (totalResults > 0 && firstChannel.items.length > 0) {
      var item;
      html += "<table class=\"networkTable\" border=\"0\" cellpadding=\"2\" cellspacing=\"1\" width=\"99%\">";
      html += "<tr class=\"TableHeader\" valign=\"bottom\">";
      html += "<td>URL from index (total results = " + totalResults + ")<\/td>";
      for (var i = 0; i < firstChannel.items.length; i++) {
        item = firstChannel.items[i];
        html += "<tr><td><a href=\"HostBrowser.html?pathsearch=&amp;path=" + item.link + "\">" + item.link + "<\/a><\/td>";
      }
      html += "<\/table>";
    }
    document.getElementById("searchresults").innerHTML = html;
  }
//]]>
</script>
</head>

<body id="hostBrowser">
  #(topmenu)#
  #%env/templates/page-start.template%#
  ::
  #%env/templates/page-start.template%#
  #(/topmenu)#

  <div id="devInfo" data-done="html5" data-todo="code scipts">
    - use a template for InfoCacheEntry
  </div>

  <h1>Host Browser</h1>
  <p>
    Browse the index of <code>#[ucount]#</code> documents. Enter a host or an <abbr>URL</abbr> for a file list or view a list of <a href="/HostBrowser.html?hosts=">all hosts</a>, <a href="/HostBrowser.html?hosts=crawling">only hosts with urls pending in the crawler</a> or <a href="/HostBrowser.html?hosts=error">only with load errors</a>.
  </p>

  <form action="HostBrowser.html" id="searchform" method="get" onkeyup="xmlhttpPost(); return false;">
    <fieldset>
      <legend>Host search</legend>
      <fieldset class="formSection">
        <legend>Host/URL</legend>
        <div class="content">
          <input id="search" type="text" name="path" value="#[path]#" size="80" maxlength="250" />
        </div>
      </fieldset>
      <fieldset class="formControl">
        <div class="content">
          #(delete)#::
          <button type="submit" name="delete" class="icon-delete" onclick="return confirm('Confirm Deletion')">Delete Subpath</button>
          #(/delete)#
          <button type="submit" name="list" class="primary icon-search">Browse Host</button>
        </div>
      </fieldset>
      <br />
      <div id="searchresults"></div>
    </fieldset>
  </form>
  #[result]#

  #(hosts)#::
  <fieldset class="framed">
    <legend>Host List</legend>
    <div class="description iconLegend">
      <p>
        <i class="state urlStateOk"></i> &mdash; Hosts without any errors.
        <br/>
        <i class="state urlStateError"></i> &mdash; Hosts with errors.
        <br/>
      </p>
      <p>
        <i class="state stateCommit"></i> &mdash; number of commited <abbr>URLs</abbr>.
        <br/>
        <i class="state statePending"></i> &mdash; number of pending <abbr>URLs</abbr>.
        <br/>
        <i class="state stateError"></i> &mdash; <abbr>URL</abbr> Load Errors (exclusion/failure).
      </p>
      <div class="clear"></div>
    </div>
    <fieldset class="formSection">
      <div class="content noIndent">
        <ul class="hostList fa-ul">
          #{list}#
          <li>
            <i class="fa-li fa urlState#(type)#Ok::Error#(/type)#"></i>
            <a href="/HostBrowser.html?path=#[host]#&facetcount=#[count]#">#[host]#</a>
            <p>
              <span class="state stateCommit" title="#[count]# URLs commited">#[count]#</span>
              #(crawler)#::
              <span class="state statePending" title="#[pending]# URLs pending">#[pending]#</span>
              #(/crawler)#
              #(errors)#::
              <span class="state stateError" title="#[exclcount]# URLs excluded, #[failcount]# URLs failed">#[exclcount]#/#[failcount]#</span>
              #(/errors)#
            </p>
          </li>
          #{/list}#
        </ul>
        <div class="clear"></div>
        <div style="clear:both; float:left; padding:10px 5px 1px 5px;">
          <div style="float:left;clear:both;">Count Colors:</div>
          <div class="commit" style="float:left;">&nbsp;&nbsp;&nbsp;Documents without Errors</div>
          <div class="pending" style="float:left;">&nbsp;&nbsp;&nbsp;Pending in Crawler</div>
          <div class="error" style="float:left;">&nbsp;&nbsp;&nbsp;Load Errors (exclusion/failure)</div>
        </div>
      </div>
    </fieldset>
  </fieldset>
  #(/hosts)#

  #(files)#::
  <fieldset class="framed" id="hostBrowserFiles">
    <legend>Browser for <a href="#[path]#" target="_blank">#[path]#</a></legend>
    <div class="description">
      <p>
        Documents stored for host: <code>#[hostsize]#</code>
        <br/>
        Documents stored for subpath: <code>#[subpathloadsize]#</code>
        <br/>
        Unloaded documents detected in subpath: <code>#[subpathdetectedsize]#</code>
        <!-- #(complete)#;<a href="/HostBrowser.html?complete=true&path=#[path]#">get complete list</a>::<a href="/HostBrowser.html?path=#[path]#">directory view</a>#(/complete)#-->
      </p>
    </div>
    <fieldset class="formGroup">
      <legend>Contents</legend>
      <fieldset class="formSection">
        <div class="content noIndent">
          <table class="sortable">
            <thead>
              <tr>
                <th></th>
                <th>Path</th>
                <th>stored</th>
                <th>linked</th>
                <th>pending</th>
                <th>excluded</th>
                <th>failed</th>
              </tr>
            </thead>
            <tbody>
              #(root)#
              <tr>
                <td></td>
                <td class="breakAll"><a href="/HostBrowser.html?path=#[path]##hostBrowserFiles" class="listing">..</a></td>
                <td colspan="5"></td>
              </tr>
              ::
              #(/root)#
              #{list}#
              #(type)#
              <!--file-->
              <tr>
                <td>
                  <a href="/ViewFile.html?url=#[url]#" title="Show Metadata" class="iconic">
                    <i class="fa fa-file"></i>
                  </a>
                </td>
                <td class=#(stored)#"listingem"::"listing"#(/stored)#>
                  <a href="#[url]#" target="_blank">#[url]#</a>
                </td>
                #(stored)#
                #(load)#
                <td colspan="5" class="listingem">link, detected from context</td>
                ::
                <td colspan="5" class="listingnok">
                  <a href="/HostBrowser.html?load=#[url]#&path=#[path]##hostBrowserFiles"><span class="state stateError">load &amp; index</span></a>
                </td>
                #(/load)#
                ::
                <td colspan="1">indexed</td>
                <td colspan="4" class="noExtLinkIcon">#[comment]#</td>
                ::
                <td colspan="5"><span class="state statePending">loading</span></td>
                ::
                <td colspan="5"><span class="state stateError">#[error]#</span></td>
                #(/stored)#
              </tr>
              ::<!--folder-->
              <tr>
                <td><i class="fa fa-folder"></i></td>
                <td><a href="/HostBrowser.html?path=#[url]##hostBrowserFiles" class="listing">#[url]#</a></td>
                <td class="commit">#[stored]#</td>
                <td>#[linked]#</td>
                <td #(pendingVisible)#class="listingem"::class="pending"#(/pendingVisible)#>#[pending]#</td>
                <td #(excludedVisible)#class="listingem"::class="error"#(/excludedVisible)#>#[excluded]#</td>
                <td #(failedVisible)#class="listingem"::class="error"#(/failedVisible)#>#[failed]#</td>
              </tr>
              #(/type)#
              #{/list}#
            </tbody>
          </table>
        </div>
      </fieldset>
    </fieldset>
    #(/files)#

    #(outbound)#::
    <fieldset class="formGroup">
      <legend>Outbound Links</legend>
      <div class="description">
        <p>
          Outbound Links, outgoing from <code>#[host]#</code> &mdash; Host List
        </p>
      </div>
      <fieldset class="formSection noIndent">
        <div class="content">
          <ul class="hostList fa-ul">
            #{list}#
            <li>
              <a href="/HostBrowser.html?path=#[link]#hostBrowserFiles">#[host]#</a>
              <p>
                #[count]# URLs
              </p>
            </li>
            #{/list}#
          </ul>
          <div class="clear"></div>
          #(admin)#::
          <fieldset class="framed">
            <legend>WebStructure</legend>
            <img src="/WebStructurePicture_p.png?host=#[host]#&depth=3&width=1024&height=576&nodes=200&time=1000&colortext=888888&colorback=FFFFFF&colordot0=1111BB&colordota=11BB11&colorline=222222&colorlineend=333333">
          </fieldset>
          #(/admin)#
        </div>
      </fieldset>
    </fieldset>
    #(/outbound)#

    #(inbound)#::
    <fieldset class="formGroup">
      <legend>Inbound Links</legend>
      <div class="description">
        <p>
          Inbound Links, incoming to <code>#[host]#</code> &mdash; Host List
        </p>
      </div>
      <fieldset class="formSection">
        <div class="content noIndent">
          <ul class="hostList fa-ul">
            #{list}#
            <li>
              <a href="/HostBrowser.html?path=#[host]#hostBrowserFiles">#[host]#</a>
              <p>
                #[count]# URLs
              </p>
            </li>
            #{/list}#
          </ul>
          <div class="clear"></div>
        </div>
      </fieldset>
    </fieldset>
    #(/inbound)#
  </fieldset>

  #(admin)#::
  #%HostBrowserAdmin_p.html%#
  #(/admin)#

  #%env/templates/page-end.template%#
</body>
</html>
